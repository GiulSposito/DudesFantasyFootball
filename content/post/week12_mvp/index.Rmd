---
title: '[Week 12] League MVPs'
author: "Giuliano Sposito"
date: '2019-11-27'
displayInList: yes
displayInMenu: no
dropCap: yes
draft: no
resources:
- name: featuredImage
  params:
    description: Lamar CMC and Wilson
  src: lamar_cmc_wilson_mvp_split.jpg
slug: mvp-week-12
tags:
- rank
- points
categories:
- ranking
params:
  week: 12
editor_options: 
  chunk_output_type: console
---

Top Players: CMC, Lamar, Thomas, Cook and Wilson

<!--more-->

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
# put rnotbook in the same workdir
knitr::opts_knit$set(root.dir = normalizePath(rprojroot::find_rstudio_root_file())) 
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r load}
# libs
library(tidyverse)
library(glue)
library(knitr)

# player points and players (has the urls)
pp <- readRDS("./data/players_points.rds")
players <- readRDS("./data/players.rds")

# parameter
.week <- params$week
.n <- 5

# summarise player points
players.points <- pp %>% 
  filter(week <= .week) %>% 
  select(id, nfl_id, name, position, week, points) %>% 
  group_by(id, nfl_id, name, position) %>% 
  summarise(points=sum(points, na.rm = T)) %>% 
  ungroup() %>% 
  # rejoin with the team of last available week (current team)
  inner_join(
    select(filter(pp, week==max(week)), id, nfl_id, team),
    by = c("id", "nfl_id")
  ) %>% 
  # join with players to get image URLs
  inner_join(
    select(players, playerId, imageUrl, smallImageUrl, largeImageUrl),
    by=c("nfl_id"="playerId")
  )

```

## Top Players

```{r topPlayers}

# retorna a tabela dos melhores jogadores
topPlayersTable <- function(.players, .position="", .size){
  
  # filtra por posicao 
  if(.position==""){
    selplayers <- .players
  } else {
    selplayers <- filter(.players, position==.position)  
  }
  
  # rankeia
  selplayers %>% 
    top_n(.size, points) %>% 
    arrange(desc(points)) %>% 
    mutate( rank = 1:nrow(.),
            image = glue("<img src='{imageUrl}' style='width: 80px; height: 80px'/>")) %>% 
    select(rank, image, name, position, team, points ) %>% 
    kable()
}

topPlayersTable(players.points, "", 5)

```


## Quaterbacks

```{r topQBs}

topPlayersTable(players.points, "QB", 5)

```

## Wide Receivers

```{r topWRs}

topPlayersTable(players.points, "WR", 5)

```

## Running Backs

```{r topRBs}

topPlayersTable(players.points, "RB", 5)

```

## Tight Ends

```{r topTEs}

topPlayersTable(players.points, "TE", 5)

```

## Kickers

```{r topKs}

topPlayersTable(players.points, "K", 5)

```

## Defenses

```{r topDEFs}

topPlayersTable(players.points, "DEF", 5)

```
