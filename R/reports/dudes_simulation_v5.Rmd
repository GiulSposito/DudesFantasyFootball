---
title: "Dudes Football League - Simulation"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
params:
  week: 1
  prefix: "preTNF"
---

```{r setup, include=FALSE}

# put rnotbook in the same workdir
knitr::opts_knit$set(root.dir = normalizePath(rprojroot::find_rstudio_root_file())) 
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

```



```{r libs}
library(flexdashboard)
library(tidyverse)
#library(formattable)
library(ggrepel)
library(glue)
library(broom)

week <- params$week
prefix <- params$prefix

# fixed positions
slotLevels <- gl(8,1,labels=c("QB","RB","WR","TE","W/R","K","DEF","BN"))
posLevels <- gl(6,1,labels=c("QB","RB","WR","TE","K","DEF"))

sim <- readRDS(glue("./data/simulation_v5_week{week}_{prefix}.rds")) 


# sim.summary <- tibble(
#   team.id   = c(sim$home.id,   sim$away.id),
#   team.name = c(sim$home.name,     sim$away.name),
#   pts.summ  = c(sim$home.points,   sim$away.points),
#   points    = c(sim$home.sim,      sim$away.sim),
#   win.pc    = c(sim$home.win.prob, sim$away.win.prob),
#   roster    = c(sim$home.roster, sim$away.roster)
# ) 

sim_summary <- bind_rows(
    select(sim$matchup_sim, teamId=awayTeam.teamId, winProb=awayTeam.winProb),
    select(sim$matchup_sim, teamId=homeTeam.teamId, winProb=homeTeam.winProb)
  ) %>% inner_join(select(sim$teams, -rosters), by="teamId")


winGauge <- function(.teamId, .teamSummary) {
  values <- .teamSummary %>%
    filter(teamId == .teamId) %>%
    mutate( winProb = round(100*winProb) ) %>%
    select(name, winProb)
  
  gauge(value=values$winProb, min = 0, max = 100, symbol = '%', label = values$name,
          gaugeSectors(success = c(61, 100), warning = c(40, 60), danger = c(0, 39)))
}

```

Win Probability {data-navmenu="Overview"}
=======================

Row
------------------

### 
```{r}
winGauge(1,sim_summary)
winGauge(2,sim_summary)
winGauge(3,sim_summary)
winGauge(4,sim_summary)
```


Row
------------------

### 
```{r}
winGauge(5,sim_summary)
winGauge(6,sim_summary)
winGauge(7,sim_summary)
winGauge(8,sim_summary)
```


Row
------------------

### 
```{r}
winGauge(9,sim_summary)
winGauge(10,sim_summary)
winGauge(11,sim_summary)
winGauge(12,sim_summary)
```


Row
------------------

### 
```{r}
winGauge(13,sim_summary)
winGauge(14,sim_summary)
```
